<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Copyright 2015-03-26T14:32:11-02:30, Rod Byrne --><title>git-devel</title>
<link rel="stylesheet" href="../css/online.css" type="text/css">
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
</head>
<body><div class="notes">
<div class="slide">
<h1>Picture Editor Setup </h1>
<div>
<p>
        This applications implements an simple
        graphic editor that uses SVG.
        The directory and contents setup
        for this project is:
    </p>
<ul>
<li>
<tt>build.xml</tt> [M]</li>
<li>
<tt>ivy.xml</tt> [M]</li>
<li>
<tt>src</tt><ul>
<li>
<tt>App.java</tt> [M]</li>
<li>
<tt>Edit.java</tt> [E]</li>
<li>
<tt>Store.java</tt> [S]</li>
</ul>
</li>
<li>
<tt>static</tt><ul>
<li>
<tt>index.html</tt> [M]</li>
<li>
<tt>error.html</tt> [S]</li>
<li>
<tt>css</tt><ul>
<li>
<tt>app.css</tt> [M]</li>
<li>
<tt>svg.css</tt> [E]</li>
</ul>
</li>
<li>
<tt>js</tt><ul><li>
<tt>edit.js</tt> [E]</li></ul>
</li>
</ul>
</li>
</ul>
<p>
       The [M] indicates that the <tt>master</tt>
       branch developer is responsible.
       The [E] is the <tt>pic_edit</tt> branch, and [S] is
       the <tt>store</tt> branch.
    </p>
<p>
        The <tt>build.xml</tt> file contains an <em>ant</em>
        script to build the picture editor web application. It also
        downloads any required jar files.
    </p>
<p>
       The <tt>ivy.xml</tt> file specifies the dependencies.
       A dependencies is the jar files (Java classes) that are
       used in this project, but are external to the project.
       A particular jar file can also depend on other jar files.
    </p>
<p>
       The <tt>src</tt> directory contains all the java code.
    </p>
<p>
       The <tt>static</tt> directory contains the
       html, css, and javascript files.
    </p>
</div>
</div>
<div class="slide">
<h1>Running the picture application</h1>
<div>
<p>
        The web server is started with:
    </p>
<div class="highlight"><pre>% ant pics
</pre></div>
<p>
        The server can be tested by typing
        <tt>http://localhost:8090</tt>
        in a browsers URL field. Alternative the <tt>curl</tt>
        command can be used.
    </p>
<div class="highlight"><pre>% curl http://localhost:8090
</pre></div>
</div>
</div>
<div class="slide">
<h1>App.java</h1>
<div>
<p> The main class is: </p>
<h2 class="src-name"><a href="pictures/src/App.java">pictures/src/App.java</a></h2>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">port</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">externalStaticFileLocation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">out</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">)</span> <span class="o">{</span>
        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">msg</span> <span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">port</span><span class="o">(</span><span class="mi">8090</span><span class="o">);</span> <span class="c1">// change to port to 8090</span>
        <span class="n">externalStaticFileLocation</span><span class="o">(</span><span class="s">"static"</span><span class="o">);</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/index.html"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="o">);</span>

        <span class="c1">// client editing</span>
        <span class="n">Edit</span><span class="o">.</span><span class="na">sparkSetup</span><span class="o">();</span>
        <span class="c1">// back-in storage</span>
        <span class="n">Store</span><span class="o">.</span><span class="na">sparkSetup</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>Edit.java</h1>
<div>
<p> The editing server side is: </p>
<h2 class="src-name"><a href="pictures/src/Edit.java">pictures/src/Edit.java</a></h2>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">post</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">halt</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">file</span><span class="o">.</span><span class="na">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Edit</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">STORE_PATH</span> <span class="o">=</span> <span class="s">"./store/"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EDIT_TEMPLATE</span> <span class="o">=</span> <span class="s">"./templates/circles.html"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EDIT_PAGE</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sparkSetup</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">EDIT_PAGE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">readAllBytes</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">EDIT_TEMPLATE</span><span class="o">)));</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span> <span class="n">IOException</span> <span class="n">ex</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"no templates"</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span> <span class="mi">1</span> <span class="o">);</span>
        <span class="o">}</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/pictures/edit/:user/:pic"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
             <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
             <span class="n">String</span> <span class="n">pic</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"pic"</span><span class="o">);</span>
             <span class="k">if</span> <span class="o">(</span>  <span class="n">user</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">pic</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
                 <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"pics-dit missing values"</span><span class="o">);</span>
                 <span class="n">halt</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="s">"missing values"</span><span class="o">);</span>
             <span class="o">}</span>
             <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"handeling: /pictures/edit"</span><span class="o">);</span>
             <span class="n">response</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/html"</span><span class="o">);</span>
             <span class="k">try</span> <span class="o">{</span>
                 <span class="n">Path</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">STORE_PATH</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pic</span> <span class="o">);</span>
                 <span class="n">String</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">readAllBytes</span><span class="o">(</span><span class="n">p</span><span class="o">));</span>
                 <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">EDIT_PAGE</span><span class="o">,</span> <span class="n">source</span><span class="o">);</span>
             <span class="o">}</span>
             <span class="k">catch</span><span class="o">(</span> <span class="n">IOException</span> <span class="n">ex</span> <span class="o">)</span> <span class="o">{</span>
                 <span class="n">response</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/error.html"</span><span class="o">);</span>
                 <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
             <span class="o">}</span>
        <span class="o">}</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>Store.java</h1>
<div>
<p> The class that manages access to the pictures is:</p>
<h2 class="src-name"><a href="pictures/src/Store.java">pictures/src/Store.java</a></h2>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">put</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">halt</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">file</span><span class="o">.</span><span class="na">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Path</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Store</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">A_LINK</span> <span class="o">=</span> 
        <span class="s">"&lt;a href='/pictures/edit/%s/%s'&gt;%s&lt;/a&gt;\n"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">STORE_PATH</span> <span class="o">=</span> <span class="s">"./store"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LIST_PAGE</span> <span class="o">=</span> 
        <span class="s">"&lt;!DOCTYPE html&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;html&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;head&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;title&gt;Pictures Listing Page&lt;/title&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;meta charset='UTF-8'&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;link rel='stylesheet' type='text/css' href='/css/app.css'&gt;\n"</span> <span class="o">+</span> 
        <span class="s">"&lt;/head&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;body&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;h1&gt;Users&lt;/h1&gt;\n"</span> <span class="o">+</span>
        <span class="s">"%s\n"</span> <span class="o">+</span>
        <span class="s">"&lt;/body&gt;\n"</span> <span class="o">+</span>
        <span class="s">"&lt;/html&gt;\n"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sparkSetup</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// list the pictures belonged to a user</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/pictures/:user"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
             <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
             <span class="k">if</span> <span class="o">(</span> <span class="n">user</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
                 <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"store list: missing values"</span><span class="o">);</span>
                 <span class="n">halt</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="s">"missing values"</span><span class="o">);</span>
             <span class="o">}</span>
             <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"handeling: /pictures/"</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
             <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span> <span class="n">STORE_PATH</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">user</span> <span class="o">);</span>
             <span class="k">if</span><span class="o">(</span> <span class="o">!</span><span class="n">dir</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()</span> <span class="o">)</span> <span class="o">{</span>
                  <span class="n">response</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/error.html"</span><span class="o">);</span>
                  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
             <span class="o">}</span>
             <span class="n">String</span><span class="o">[]</span> <span class="n">list</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
             <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
             <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;ul&gt;\n"</span><span class="o">);</span>
             <span class="k">for</span> <span class="o">(</span> <span class="n">String</span> <span class="n">n</span> <span class="o">:</span> <span class="n">list</span> <span class="o">)</span> <span class="o">{</span>
                 <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;li&gt;\n"</span><span class="o">);</span>
                 <span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">A_LINK</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">n</span> <span class="o">);</span>
                 <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span> <span class="n">a</span> <span class="o">);</span>
                 <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;/li&gt;\n"</span><span class="o">);</span>
             <span class="o">}</span>
             <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;/ul&gt;\n"</span><span class="o">);</span>
             <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span> <span class="n">LIST_PAGE</span><span class="o">,</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">);</span>
        <span class="o">}</span> <span class="o">);</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/pictures/:user/:pic"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">pic</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"pic"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span> <span class="n">user</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">pic</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
               <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"pictures get missing values"</span><span class="o">);</span>
               <span class="n">halt</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="s">"missing values"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">response</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"image/svg+xml"</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Path</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">STORE_PATH</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pic</span> <span class="o">);</span>
                <span class="n">String</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">readAllBytes</span><span class="o">(</span><span class="n">p</span><span class="o">));</span>
                <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">catch</span><span class="o">(</span> <span class="n">IOException</span> <span class="n">ex</span> <span class="o">)</span> <span class="o">{</span>
                <span class="n">response</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/error.html"</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="o">);</span>

        <span class="n">put</span><span class="o">(</span><span class="s">"/pictures/:user/:pic"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">pic</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"pic"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span> <span class="n">user</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">pic</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
               <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"pictures get missing values"</span><span class="o">);</span>
               <span class="k">return</span> <span class="s">"missing values"</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Path</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">STORE_PATH</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">pic</span> <span class="o">);</span>
                <span class="n">BufferedWriter</span> <span class="n">wt</span> <span class="o">=</span>
                    <span class="k">new</span> <span class="nf">BufferedWriter</span><span class="o">(</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span> <span class="n">p</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">));</span>
                <span class="n">String</span> <span class="n">b</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
                <span class="n">App</span><span class="o">.</span><span class="na">log</span><span class="o">(</span> <span class="n">b</span> <span class="o">);</span>
                <span class="n">wt</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="n">b</span> <span class="o">);</span>
                <span class="n">wt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="k">return</span> <span class="s">"ok"</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">catch</span><span class="o">(</span> <span class="n">IOException</span> <span class="n">ex</span> <span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"failed"</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>edit.js</h1>
<div>
<p> Client side editing is provided by:</p>
<h2 class="src-name"><a href="pictures/static/js/edit.js">pictures/static/js/edit.js</a></h2>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">make_draggable</span><span class="p">(</span> <span class="nx">drawing</span><span class="p">,</span> <span class="nx">circle</span><span class="p">,</span> <span class="nx">hit_x</span><span class="p">,</span> <span class="nx">hit_y</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">mkPt</span><span class="p">(</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pt</span> <span class="o">=</span> <span class="nx">drawing</span><span class="p">.</span><span class="nx">createSVGPoint</span><span class="p">();</span>
        <span class="nx">pt</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">pt</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">pt</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">circle</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"selected"</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">mat</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">getScreenCTM</span><span class="p">();</span>
    <span class="c1">// circle in screen coordinates</span>
    <span class="kd">var</span> <span class="nx">cpt</span> <span class="o">=</span> <span class="nx">mkPt</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">cx</span><span class="p">.</span><span class="nx">animVal</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">cy</span><span class="p">.</span><span class="nx">animVal</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">cpt</span> <span class="o">=</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">matrixTransform</span><span class="p">(</span> <span class="nx">mat</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">hit_offset_x</span> <span class="o">=</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">hit_x</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hit_offset_y</span> <span class="o">=</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">hit_y</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">inv</span> <span class="o">=</span> <span class="nx">mat</span><span class="p">.</span><span class="nx">inverse</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">drag</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pt</span> <span class="o">=</span> <span class="nx">mkPt</span><span class="p">(</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientY</span> <span class="p">);</span>
        <span class="kd">var</span> <span class="nx">trans_pt</span> <span class="o">=</span> <span class="nx">pt</span><span class="p">.</span><span class="nx">matrixTransform</span><span class="p">(</span> <span class="nx">inv</span> <span class="p">);</span>
        <span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span> <span class="nx">trans_pt</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">hit_offset_x</span> <span class="p">);</span>
        <span class="nx">circle</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span> <span class="nx">trans_pt</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">hit_offset_y</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">stop_drag</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">circle</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"selected"</span><span class="p">);</span>
        <span class="nx">drawing</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">"mouseleave"</span><span class="p">,</span> <span class="nx">stop_drag</span> <span class="p">);</span>
        <span class="nx">drawing</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">"mouseup"</span><span class="p">,</span> <span class="nx">stop_drag</span> <span class="p">);</span>
        <span class="nx">drawing</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span> <span class="nx">drag</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">drawing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mouseleave"</span><span class="p">,</span> <span class="nx">stop_drag</span> <span class="p">);</span>
    <span class="nx">drawing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mouseup"</span><span class="p">,</span> <span class="nx">stop_drag</span> <span class="p">);</span>
    <span class="nx">drawing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mousemove"</span><span class="p">,</span> <span class="nx">drag</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"load"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">svg_drawing</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"svg#drawing"</span><span class="p">);</span>
    <span class="nx">svg_drawing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mouseenter"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"enter"</span><span class="p">,</span> <span class="nx">evt</span> <span class="p">);</span>
    <span class="p">}</span> <span class="p">);</span>

    <span class="c1">// register mouse down to select circles to drag</span>
    <span class="nx">svg_drawing</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"mousedown"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//console.log(document.elementFromPoint(evt.clientX, evt.clientY));</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">);</span>
        <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
        <span class="c1">// needed for firefox to prevent default dragging</span>
        <span class="nx">evt</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="c1">// only drag circles</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">target</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">target</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">!==</span> <span class="s2">"circle"</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">make_draggable</span><span class="p">(</span> <span class="nx">svg_drawing</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">clientY</span> <span class="p">);</span>
    <span class="p">});</span>
    
    <span class="kd">var</span> <span class="nx">save_button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"button#save"</span><span class="p">);</span>
    <span class="nx">save_button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pic_path</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">new_path</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">new_path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">pic_path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
        <span class="nx">new_path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">pic_path</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">);</span>
        <span class="nx">new_path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">pic_path</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="p">);</span>
        <span class="nx">new_path</span> <span class="o">=</span> <span class="nx">new_path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">'//'</span><span class="p">;</span>
        <span class="nx">url</span> <span class="o">+=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">new_path</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="s2">"PUT"</span><span class="p">,</span> <span class="nx">url</span> <span class="p">);</span>
        <span class="kd">var</span> <span class="nx">xml</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLSerializer</span><span class="p">().</span><span class="nx">serializeToString</span><span class="p">(</span><span class="nx">svg_drawing</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">xml</span> <span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">xml</span> <span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// reload the replace, to reload the current picture</span>
    <span class="kd">var</span> <span class="nx">reset_button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"button#reset"</span><span class="p">);</span>
    <span class="nx">reset_button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">(</span> <span class="kc">true</span> <span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>svg.css</h1>
<div>
<p> CSS can be used to aid the user interface.</p>
<h2 class="src-name"><a href="pictures/static/css/svg.css">pictures/static/css/svg.css</a></h2>
<div class="highlight"><pre><span class="nt">svg</span> <span class="p">{</span>
    <span class="k">border</span> <span class="o">:</span> <span class="nb">blue</span> <span class="k">thin</span> <span class="k">solid</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
    <span class="k">margin-right</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
    <span class="k">display</span> <span class="o">:</span> <span class="k">block</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">svg</span> <span class="nt">circle</span><span class="nc">.selected</span> <span class="p">{</span>
    <span class="k">opacity</span> <span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">3</span><span class="p">;</span>
    <span class="k">cursor</span><span class="o">:</span> <span class="n">move</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>circles.html</h1>
<div>
<p>The editing html page is:</p>
<h2 class="src-name"><a href="pictures/templates/circles.html">pictures/templates/circles.html</a></h2>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/css/svg.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/js/edit.js"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Editing<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"save"</span><span class="nt">&gt;</span> Save Picture <span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"reset"</span><span class="nt">&gt;</span> Reset Picture <span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"drawing-area"</span><span class="nt">&gt;</span>
%s
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</pre></div>
</div>
</div>
<div class="slide">
<h1>Git Project Setup</h1>
<div>
<p>
        The person responsible for setting up the projects,
        sets up the <tt>master</tt> branch.
        This person is also responsible for merging any
        <em>topic</em> branches.
    </p>
<div class="highlight"><pre>% cd pictures
% ls -lR
.:
total 24
-rw------- 1 rod rod 1783 Mar 21 15:41 build.xml
drwx------ 2 rod rod 4096 Mar 21 15:45 classes
-rw------- 1 rod rod  701 Mar 21 15:10 ivy.xml
drwx------ 2 rod rod 4096 Mar 21 15:45 lib
drwx------ 2 rod rod 4096 Mar 21 15:40 src
drwx------ 4 rod rod 4096 Mar 21 15:24 static

./classes:
total 0

./lib:
total 0

./src:
total 4
-rw------- 1 rod rod 524 Mar 21 15:36 App.java

./static:
total 12
drwx------ 2 rod rod 4096 Mar 21 15:30 css
-rw------- 1 rod rod  255 Mar 21 15:24 index.html
drwx------ 2 rod rod 4096 Mar 21 15:26 js

./static/css:
total 4
-rw------- 1 rod rod  46 Mar 21 15:18 app.css

./static/js:
total 0
% git init .
Initialized empty Git repository in pictures/.git/
% git add .gitignore src build.xml ivy.xml
% git add static/index.html static/css/app.css
On branch master

Initial commit

Changes to be committed:
  (use "git rm --cached &lt;file&gt;..." to unstage)

    new file:   .gitignore
    new file:   build.xml
    new file:   ivy.xml
    new file:   src/App.java
    new file:   static/css/app.css
    new file:   static/index.html
% git commit -m "project set up"
 6 files changed, 124 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 build.xml
 create mode 100644 ivy.xml
 create mode 100644 src/App.java
 create mode 100644 static/css/app.css
 create mode 100644 static/index.html
% git status
On branch master
nothing to commit, working directory clean
</pre></div>
<p>
          The <tt>.gitignore</tt> file specifies
          the directories that <tt>git</tt> will
          ignore. The directories are created by programs,
          and not be a person. The contents of <tt>.gitignore</tt> is:
    </p>
<div class="highlight"><pre>classes
lib
</pre></div>
</div>
</div>
<div class="slide">
<h1>Client Side Starts</h1>
<div>
<p>
        The developer responsible for doing the client side
        editing, clones the repo, and set up a <em>topic</em> branch.
        The developer then adds the <tt>Edit.java</tt>
        and modifes <tt>App.java</tt>. Some CSS and javascript
        files are added, as well as an initial user's picture.
    </p>
<div class="highlight"><pre>% git branch pic_edit
% git checkout pic_edit
Switched to branch 'pic_edit'
% git branch
  master
* pic_edit
% git add src/App.java src/Edit.java 
% git add static/css/svg.css
% git add static/js/edit.js 
% git add store
% # the contents of store is
% ls -R store
store/:
foo

store/foo:
pic1.svg
% # foo is the user and pic1.svg is a picture
% git status
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    modified:   src/App.java
    new file:   src/Edit.java
    new file:   static/css/svg.css
    new file:   static/js/edit.js
    new file:   store/foo/pic1.svg
% git commit -m "initial client side editing"
 5 files changed, 120 insertions(+)
 create mode 100644 src/Edit.java
 create mode 100644 static/css/svg.css
 create mode 100644 static/js/edit.js
 create mode 100644 store/foo/pic1.svg
</pre></div>
<p>
        The editor developer wants the rest of the team to 
        to try their first version. To ensure a clean commit,
        the editor developer <em>rebases</em> their repo.
        The developer for the <tt>master</tt> branch is asked
        to merge the <tt>pic_edit</tt> topic branch.
    </p>
<div class="highlight"><pre>% git rebase master
Current branch pic_edit is up to date.
</pre></div>
</div>
</div>
<div class="slide">
<h1>Storing At The Server Development</h1>
<div>
<p>
        The developer responsible for storing and retrieving 
        the pictures clones the repo, and sets up a topic branch.
        The storage developer creates the branch from the initial
        commit (There are no changes from <tt>pic_edit</tt>.
    </p>
<div class="highlight"><pre>% git branch store  # create a branch
% git branch  # see what branches are in the repo
* master
  pic_edit
  store
% git checkout store
Switched to branch 'store'
</pre></div>
</div>
</div>
<div class="slide">
<h1>Master merges pic_edit</h1>
<div>
<p>
        The <tt>master</tt> developer merges the <tt>pic_edit</tt>
        branch.
    </p>
<div class="highlight"><pre>% git checkout master
% git branch
* master
  pic_edit
  store
% git merge pic_edit
Fast-forward
 src/App.java       |  2 ++
 src/Edit.java      | 18 ++++++++++++
 static/css/svg.css | 10 +++++++
 static/js/edit.js  | 84 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 store/foo/pic1.svg |  6 ++++
 5 files changed, 120 insertions(+)
 create mode 100644 src/Edit.java
 create mode 100644 static/css/svg.css
 create mode 100644 static/js/edit.js
 create mode 100644 store/foo/pic1.svg
</pre></div>
<p><em>Fast-forward</em> means that the topic branch
        just extends the <tt>master</tt> branch, there in only one linear
        history.
    </p>
</div>
</div>
<div class="slide">
<h1>Store Developer Works</h1>
<div>
<p>
        The store developer creates the picture listing page.
        The developer commits the following:
    </p>
<div class="highlight"><pre>% git add src/App.java src/Store.java static/error.html
On branch store
Changes to be committed:
  (use "git reset HEAD &lt;file&gt;..." to unstage)

    modified:   src/App.java
    new file:   src/Store.java
    new file:   static/error.html
% git commit -m "picture listing down"
[store fb2687c] picture listing down
 3 files changed, 66 insertions(+)
 create mode 100644 src/Store.java
 create mode 100644 static/error.html
</pre></div>
</div>
</div>
<div class="slide">
<h1>Store Developer Rebase Conflict</h1>
<div>
<p>
        The store developer wants to share the work, a
        <em>rebase</em> allows the work to be shared easily.
    </p>
<div class="highlight"><pre>% git rebase master
First, rewinding head to replay your work on top of it...
Applying: picture listing down
Using index info to reconstruct a base tree...
M   src/App.java
&lt;stdin&gt;:28: trailing whitespace.
    private static final String A_LINK = 
&lt;stdin&gt;:31: trailing whitespace.
    private static final String LIST_PAGE = 
&lt;stdin&gt;:37: trailing whitespace.
        "&lt;link rel='stylesheet' type='text/css' href='/css/app.css'&gt;\n" + 
warning: 3 lines add whitespace errors.
Falling back to patching base and 3-way merge...
Auto-merging src/App.java
CONFLICT (content): Merge conflict in src/App.java
Failed to merge in the changes.
Patch failed at 0001 picture listing down
The copy of the patch that failed is found in:
   /home/rod/MUN/Winter2015/cs3715/pictures/.git/rebase-apply/patch

When you have resolved this problem, run "git rebase --continue".
If you prefer to skip this patch, run "git rebase --skip" instead.
To check out the original branch and stop rebasing, run "git rebase --abort".
</pre></div>
<p>
        Unfortunately, a conflict occurs in the 
        changed <tt>App.java</tt> file.
        The developer, attempts to fix the conflict
        by editing the <tt>App.java</tt> file.
        The conflict is fixed, and the <tt>App.java</tt> file
        is added to show that it is fixed.
    </p>
<div class="highlight"><pre>% git add src/App.java 
% git rebase --continue
Applying: picture listing down
</pre></div>
</div>
</div>
<div class="slide">
<h1>Store Developer Bug Fix</h1>
<div>
<p>
        The conflict is now fixed, and the store developer
        can ask the master developer to merger their branch.
        But first a bit of testing discovers a problem
        with <tt>src/Store.java</tt>. This is fixed and
        commited, and then <tt>rebased</tt>.
    </p>
<div class="highlight"><pre>% git add src/Store.java
% git commit -m "fixed &lt;/li&gt;"
[store 7783804] fixed &lt;/li&gt;
 1 file changed, 1 insertion(+), 1 deletion(-)
% git rebase master
Current branch store is up to date.
</pre></div>
</div>
</div>
<div class="slide">
<h1>Master Merges Store</h1>
<div>
<p>
        The <tt>store</tt> is now merged into the master.
    </p>
<div class="highlight"><pre>% git checkout master
% git merge master
Updating 4a3f30f..7783804
Fast-forward
 src/App.java      |  3 +++
 src/Store.java    | 52 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 static/error.html | 11 +++++++++++
 3 files changed, 66 insertions(+)
 create mode 100644 src/Store.java
 create mode 100644 static/error.html
</pre></div>
</div>
</div>
<div class="slide">
<h1>pic_edit developer Merges Store</h1>
<div>
<p>
        The <tt>pic_edit</tt> developer
        is told of the change, and the developer merges
        from the <tt>master</tt>.
    </p>
<div class="highlight"><pre>% git checkout pic_edit
% git merge master
Updating 4a3f30f..7783804
Fast-forward
 src/App.java      |  3 +++
 src/Store.java    | 52 ++++++++++++++++++++++++++++++++++++++++++++++++++++
 static/error.html | 11 +++++++++++
 3 files changed, 66 insertions(+)
 create mode 100644 src/Store.java
 create mode 100644 static/error.html
</pre></div>
</div>
</div>
<div class="slide">
<h1>pic_edit developer does work</h1>
<div>
<p>
        Development of the <tt>pic_edit</tt> branch starts again
        with changes to <tt>src/Edit.java</tt> and
        <tt>static/js/edit.js</tt>.
        These changes are added and committed. Rebased and a request to
        add changes to the <tt>master</tt>.
    </p>
<div class="highlight"><pre>% git add src/Edit.java static/js/edit.js
% git add templates/circles.html
% git commit -m "file selection now working"
[pic_edit fb90ce1]
3 files changed, 41 insertions(+), 30 deletions(-)
create mode 100644 src/Edit.java
create mode 100644 static/js/edit.js
create mode 100644 templates/circles.html
% git rebase master
Current branch pic_edit is up to date.
</pre></div>
</div>
</div>
<div class="slide">
<h1>Master merges pic_edit</h1>
<div>
<p>
        The master developer now merges the <tt>pic_edit</tt> 
        branch.
    </p>
<div class="highlight"><pre>% git checkout master
% git merge pic_edit 
Updating 7783804..fb90ce1
Fast-forward
  src/Edit.java          | 28 +++++++++++++++++++++++++++-
  static/js/edit.js      | 29 -----------------------------
  templates/circles.html | 14 ++++++++++++++
  3 files changed, 41 insertions(+), 30 deletions(-)
  create mode 100644 templates/circles.html
</pre></div>
</div>
</div>
<div class="slide">
<h1>Work on store branch</h1>
<div>
<p>
        Work has been done on the <tt>store</tt> branch.
        This is checked with:
    </p>
<div class="highlight"><pre>% git status
On branch store
Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

    modified:   src/Store.java

no changes added to commit (use "git add" and/or "git commit -a")
% git add src/Store.java
% git commit -m "retrieving pictures is done"
[store 1cbf5ff] retrieving pictures is done
 1 file changed, 24 insertions(+)
</pre></div>
<p>
        Rebase again and request master merge.
    </p>
<div class="highlight"><pre>% git rebase master
First, rewinding head to replay your work on top of it...
Applying: retrieving pictures is done
</pre></div>
<p>
        The master was ahead, but all changes merged cleanly.
    </p>
</div>
</div>
<div class="slide">
<h1> Master merges store branch</h1>
<div>
<p>
        The master developer now merges on <tt>store</tt> branch.
        The <tt>pic_edit</tt> branch is now no longer up to date.
    </p>
<div class="highlight"><pre>% git checkout master
Switched to branch 'master'
hp-1030:pictures % git merge store
Updating fb90ce1..98fac08
Fast-forward
 src/Store.java | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)
</pre></div>
<p>
        The master developer adds another picture to the
        <tt>foo</tt> user. This change is committed,
        and the two branch developers are told of the change.
    </p>
<div class="highlight"><pre>% git add store/foo/pic2.svg
% git commit -m "more picture data"
</pre></div>
</div>
</div>
<div class="slide">
<h1>Both store and edit merger</h1>
<div>
<p>
        Both developers merge from the master.
    </p>
<div class="highlight"><pre>% git checkout store 
Switched to branch 'store'
% git merge master
Updating 98fac08..93e9894
Fast-forward
 store/foo/pic2.svg | 6 ++++++
 1 file changed, 6 insertions(+)
 create mode 100644 store/foo/pic2.svg
% git checkout pic_edit 
Switched to branch 'pic_edit'
% git status
On branch pic_edit
nothing to commit, working directory clean
% git merge master
Updating fb90ce1..93e9894
Fast-forward
 src/Store.java     | 24 ++++++++++++++++++++++++
 store/foo/pic2.svg |  6 ++++++
 2 files changed, 30 insertions(+)
 create mode 100644 store/foo/pic2.svg
</pre></div>
<p>
        Changes come from the <tt>master</tt> and the
        <tt>store</tt> branches.
        Notice that the <tt>pic_edit</tt> merge was bigger.
    </p>
</div>
</div>
<div class="slide">
<h1>pic_edit branch continues</h1>
<div>
<p>
        In the <tt>pic_edit</tt> branch, buttons are added to the editing
        page. The javascript is updated to save and reset the picture.
        Theses changes are then commited. The <tt>pic_edit</tt> branch
        is rebased, and a merge request is made.
    </p>
<div class="highlight"><pre>% git add static/js/edit.js templates/circles.html
% git commit -m "save and reset"
 [pic_edit 9bd351e] save and reset
 2 files changed, 32 insertions(+)
% git rebase master
Current branch pic_edit is up to date.
</pre></div>
<p>
        Master merges.
    </p>
<div class="highlight"><pre>% git checkout master
Switched to branch 'master'
% git merge pic_edit
Updating 93e9894..9bd351e
Fast-forward
 static/js/edit.js      | 28 ++++++++++++++++++++++++++++
 templates/circles.html |  4 ++++
 2 files changed, 32 insertions(+)
</pre></div>
</div>
</div>
<div class="slide">
<h1>store branch merges and works</h1>
<div>
<p>
        Merge to the <tt>store</tt> branch.
    </p>
<div class="highlight"><pre>% git checkout store
Switched to branch 'store'
% git merge master
Updating 93e9894..9bd351e
Fast-forward
 static/js/edit.js      | 28 ++++++++++++++++++++++++++++
 templates/circles.html |  4 ++++
 2 files changed, 32 insertions(+)
</pre></div>
<p>
        Next change, rebase and ask for merge.
    </p>
<div class="highlight"><pre>% git add src/Store.java
% git commit -m "store saves the svg document"
[store 67f1aee] store saves the svg document
 1 file changed, 25 insertions(+), 1 deletion(-)
% git rebase master
Current branch store is up to date
</pre></div>
<p>
        Master merges.
    </p>
<div class="highlight"><pre>% git checkout master
Switched to branch 'master'
% git merge store 
Updating 9bd351e..67f1aee
Fast-forward
 src/Store.java | 26 +++++++++++++++++++++++++-
 1 file changed, 25 insertions(+), 1 deletion(-)
</pre></div>
</div>
</div>
</div></body>
</html>
